hello_msg = "üëã <b> –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π {first_name}!üëã\n –Ø –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–±–ª–µ–≥—á–∞–µ—Ç —Ç–≤–æ—é –∂–∏–∑–Ω—å –≤ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ –ø–æ—Ç–æ–º—É —á—Ç–æ —è:</b>\n\n\
‚ú®<b>–ü—Ä–æ—Å—Ç –∏ —É–¥–æ–±–µ–Ω</b>‚ú®\n\
    <i><s>–ù–∏–∫–∞–∫–∏—Ö</s> –ø–æ–∏—Å–∫–æ–≤ –∏ <s>–ª–∏—à–Ω–∏—Ö</s> –ø–æ–¥–ø–∏—Å–æ–∫ ‚Äî –ø—Ä–æ—Å—Ç–æ —á–∞—Ç !</i>\n\n\
üöÄ<b>–ù–µ –ø—Ä–µ–¥–ª–∞–≥–∞—é —Ä–µ–∫–ª–∞–º—ã</b>üöÄ\n\
    <i>–ß–∏—Å—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è !</i>\n\n\
üí°<b>–ú–µ–Ω—è <s>–Ω–µ –Ω—É–∂–Ω–æ</s> —Å–∫–∞—á–∏–≤–∞—Ç—å</b>üí°\n\
    <i>–ó–∞–±—É–¥—å –æ –ª–∏—à–Ω–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –∏ —Å–ª–æ–∂–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏!</i>\n\n\
<b>–ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∏ –¥–∞–≤–∞–π —Å—ç–∫–æ–Ω–æ–º–∏–º —Ç–≤–æ–µ –≤—Ä–µ–º—è!</b>"

choose_trolleybus_msg = "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç—Ä–æ–ª–ª–µ–π–±—É—Å–∞"
choose_station_msg = "‚úèÔ∏è<b>–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏</b>‚úèÔ∏è"
choose_station_nearest_msg = 'üó∫Ô∏è<b>–í—ã–±–µ—Ä–∏ —Å–≤–æ—é –æ—Å—Ç–∞–Ω–æ–≤–∫—É –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–∞–º—ã—Ö –±–ª–∏–∑–∫–∏—Ö</b>üó∫Ô∏è'

from collections import defaultdict

def format_distance(distance):
    if distance > 1000:
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –∫–∏–ª–æ–º–µ—Ç—Ä—ã –∏ –æ–∫—Ä—É–≥–ª—è–µ–º –¥–æ –¥–≤—É—Ö –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
        km = distance / 1000
        return f"–ü—Ä–∏–º–µ—Ä–Ω–æ {km:.0f} <i>–∫–º. –æ—Ç –≤–∞—Å</i>"
    else:
        return f"–ü—Ä–∏–º–µ—Ä–Ω–æ {distance} <i>–º. –æ—Ç –≤–∞—Å</i>"

def format_schedule(schedule, station_name, distance, mode = 1):

    grouped_schedule = defaultdict(lambda: defaultdict(list))

    for time, direction, number in schedule:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º number –∫–∞–∫ –∫–ª—é—á –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
        grouped_schedule[number][direction].append(time)

    # –®–∞–≥ 2: –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    messages = ""

    for number, directions in grouped_schedule.items():
        for direction, times in directions.items():
            # –°–æ–µ–¥–∏–Ω—è–µ–º –≤—Ä–µ–º–µ–Ω–∞ –≤ —Å—Ç—Ä–æ–∫—É, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—É—é –∑–∞–ø—è—Ç—ã–º–∏
            time_str = ", ".join(times)
            # –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –≤—Ä–µ–º–µ–Ω–∏
            message = f"<b>üöé{number}üöé</b>\n<b>{direction}:</b>\n <i>üïí {time_str}</i>\n\n"
            messages += message

    # –§–æ—Ä–º–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    if mode == 1:
        msg = f"<b>–ë–ª–∏–∂–∞–π—à–∏–µ —Ä–µ–π—Å—ã –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ \nüöè<i>{station_name}</i></b>üöè\n{format_distance(distance)}\n\n{messages}"
    elif mode == 2:
        msg = f"<b>–ë–ª–∏–∂–∞–π—à–∏–µ —Ä–µ–π—Å—ã –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ \nüöè<i>{station_name}</i></b>üöè\n\n{messages}"

    return msg
